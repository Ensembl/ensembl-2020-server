data-url: ./data/1
debug-url: ./debug

bytecodes:
    framework: |
        ; *** FIXED TEXTS ***
        const #20, {"Lato"}
        const #21, [12,0,199,208,213,255,255,255]
        const #10, {"bp"}
        text2 #12, #20, #21, #10
        ; *** bp top ***
        const #5, [3,0,1,1,1,1,2,0,1,0,0]
        const #6, [34]
        const #7, [10]
        const #8, [0]
        get #8, #12, #8
        const #18, [0]
        shape #5, #6, #18, #7, #18, #8
        ; *** bp bottom ***
        const #5, [3,0,1,1,2,1,2,0,1,0,0]
        shape #5, #6, #8, #7, #8, #8
        ; *** horiz lines top ***
        const #5, [0,1,1,2,1,1,2,0,2,0,0]
        const #6, [0,0]
        const #7, [0,0]
        const #8, [17,0]
        const #9, [1,1]
        const #10, [199,208,213]
        shape #5, #6, #7, #8, #9, #10
        ; *** horiz lines bottom ***
        const #5, [0,1,1,2,2,2,0,0,0,0,0]
        shape #5, #6, #7, #8, #9, #10
        ; *** left/right blanking ***
        const #5, [0,1,1,1,1,2,2,0,2,0,1]
        const #6, [0]
        const #7, [50]
        const #8, [16]
        const #9, [0]
        const #10, [255,255,255]
        shape #5, #6, #7, #8, #9, #10
        const #5, [0,1,2,2,1,2,2,0,2,0,1]
        shape #5, #6, #7, #8, #9, #10
        ; *** top/bottom blanking ***
        const #5, [0,1,1,2,1,1,2,0,2,0,2]
        const #6, [0]
        const #7, [0]
        const #8, [0]
        const #9, [17]
        const #10, [255,255,255]
        shape #5, #6, #7, #8, #9, #10
        const #5, [0,1,1,2,2,2,2,0,2,0,2]
        shape #5, #6, #7, #8, #9, #10
        ; *** corner blanking ***
        const #5, [0,1,1,1,1,1,2,0,2,0,0]
        const #6, [0]
        const #7, [36]
        const #8, [1]
        const #9, [15]
        const #10, [255,255,255]
        shape #5, #6, #7, #8, #9, #10
        const #5, [0,1,1,1,2,2,2,0,2,0,0]
        shape #5, #6, #7, #8, #9, #10
        ; *** bp corner mark bottom ***
        const #6, [36]
        const #7, [1]
        const #8, [1]
        const #9, [16]
        const #11, [199,208,213]
        shape #5, #6, #7, #8, #9, #11
        ; *** and top ***
        const #5, [0,1,1,1,1,1,2,0,2,0,0]
        shape #5, #6, #7, #8, #9, #11
        ; *** RULER ***
        ; 1. call ruler
        const #5, [10,10,10,10,15,20,30]
        ruler #6, #7, #8, #9, #5
        ; 2. draw marks
        const #5, [0,1,0,0,1,1,2,0,2,0,0]
        const #12, [1]
        const #13, [0]
        const #14, [17]
        shape #5, #6, #12, #13, #14, #11
        const #5, [0,1,0,0,2,2,2,0,2,0,0]
        shape #5, #6, #12, #13, #14, #11
        ; 3. draw text
        const #12, {"Lato"}
        const #13, [9,0,111,129,144,255,255,255]
        text #10, #12, #13, #9, #8
        const #5, [3,0, 0,1,1,1, 0,0,2,0, 0]
        const #14, [2]
        const #15, [17]
        shape #5, #6, #14, #15, #14, #10
        const #5, [3,0,0,1,2,1,2,0,2,0,0]
        const #15, [1]
        shape #5, #6, #14, #15, #14, #10
        ; *** LHS ***
        const #99, {"lhs"}
        setpart #99
        allplots #41,#42,#43,#44
        const #20, {"Lato"}
        const #21, [12,1,96,96,96,255,255,255]
        text #12, #20, #21, #44, #43
        const #45, [0.5]
        mul #42, #42, #45
        add #41, #41, #42
        const #5, [3,0,1,1,0,1,2,10,1,0,0]
        length #45, #41
        const #6, [12]
        runsof #6, #45, #6
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #41, #7, #12
        ; *** swatch *** XXX always first track ATM
        const #5, [0,1,1,1,0,0,2,0,2,0,0]
        const #7, [6]
        allplots #41, #42, #0, #0
        const #6, [2]
        get #41, #41, #6
        get #42, #42, #6
        const #49, [0.2]
        mul #43, #42, #49
        add #43, #43, #41
        move #44, #42
        const #49, [0.6]
        mul #44, #44, #49
        const #45, [78,168,252]
        const #6, [0]
        shape #5, #6, #7, #43, #44, #45

    contig: |
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [-3]
        add #4, #60, #62
        const #5, [6]
        const #6, [183,192,200,111,129,144]
        const #7, [3]
        pick #6, #3, #6, #7
        const #10, [1,1]
        shape #10, #1, #2, #4, #5, #6
        ; track zmenu
        const #98, {"[Contigs]"}
        const #99, {"contig"}
        ztmplspec #99, #98
        const #98, {"contig"}
        const #99, {"internal:track:contig"}
        ztmpl #99, #98
        const #100, [0,2, 1,2,0,0, 0,0,2,2, 3]
        const #101, [0]
        const #105, {"internal:track:contig"}
        shape #100, #101, #101, #4, #5, #105        
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Contigs"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #12

    contig-empty-box: |
        ; #1 = start box frag
        ; #2 = len box frag
        ; #3 = colour box frag
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [-4]
        add #13, #60, #62
        ; *** scales ***
        const #14, [8] ; #14 = box y-height
        ; *** boxes ***
        runs #7, #1, #2    ; #7 = list of box starts
        const #16, [-0.45] ; #16 = left shift ~0.5bp
        add #7, #7, #16    ; #7 = starts shifted left 0.5bp
        const #12, [0.9]   ; #12 = box size
        runsof #3, #2, #3  ; #3 = colours to positions
        const #15, [183,192,200,111,129,144] ; #15 = box colour palette
        const #17, [3]     ; #17 = pallete stride 3
        pick #15, #3, #15, #17 ; #15 = box colours
        const #16, [2,1]   ; #16 = [hollow-box,spot-colour]
        shape #16, #7, #12, #13, #14, #15 ; draw boxes
        ; track zmenu
        const #98, {"[Contigs]"}
        const #99, {"contig"}
        ztmplspec #99, #98
        const #98, {"contig"}
        const #99, {"internal:track:contig"}
        ztmpl #99, #98
        const #100, [0,2, 1,2,0,0, 0,0,2,2, 3]
        const #101, [0]
        const #105, {"internal:track:contig"}
        shape #100, #101, #101, #13, #14, #105
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Contigs"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #12

    contig-letterbox: |
        ; #1 = sequence
        ; #2 = start pos of seq frag
        ; #3 = len of seq frag
        ; #4->#3 = start box frag
        ; #5->#4 = len box frag
        ; #6->#5 = colour box frag
        ; *** scale (for size) ***
        const #17, [
             12, 24, 24, 24, 24, 24, 24, 24, 24, 24
        ] ; #17 = y-sizes Q, RZ
        scale #18 ; #18 = scale
        const #19, [-16] ; #19 = start at Q
        add #18, #18, #19 ; #18 = scale (Q-based)
        get #14, #17, #18 ; #14 = box y-height
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        move #27, #14
        const #28, [-0.5]
        mul #27, #27, #28
        add #13, #60, #27
        ; track zmenu
        const #98, {"[Contigs]"}
        const #99, {"contig"}
        ztmplspec #99, #98
        const #98, {"contig"}
        const #99, {"internal:track:contig"}
        ztmpl #99, #98
        const #100, [0,2, 1,2,0,0, 0,0,1,1, 3]
        const #101, [0]
        const #105, {"internal:track:contig"}
        shape #100, #101, #101, #60, #14, #105
        ; *** boxes ***
        runs #7, #3, #4    ; #7 = list of box starts
        const #16, [-0.45] ; #16 = left shift ~0.5bp
        add #7, #7, #16    ; #7 = starts shifted left 0.5bp
        const #12, [0.9]   ; #12 = box size
        runsof #6, #4, #5  ; #6 = colours to positions
        const #15, [183,192,200,111,129,144] ; #15 = box colour palette
        const #17, [3]     ; #17 = pallete stride 3
        pick #15, #6, #15, #17 ; #15 = box colours
        const #16, [2,1]   ; #16 = [hollow-box,spot-colour]
        shape #16, #7, #12, #13, #14, #15 ; draw boxes
        ; *** sequence ***
        const #7, {"A","C","G","T","N"} ; #7 = available sequence
        const #40, {"Lato"}
        const #41, [12,1,183,192,200,255,255,255]
        text2 #9, #40, #41, #7    ; #9 = textures for A,C,G,T
        lengths #33,#1
        burst #1,#1
        index #1, #1, #7   ; #1 = 0=A, 1=C, 2=G, 3=T for seq
        const #10, [1]     ; #10 = stride 1 for texture ids
        pick #9, #1, #9, #10 ; #9 = 0123 to tex id for seq
        const #11, [3,0,0,1,0,1,1,0,1,0,0]
        runs #7, #2, #33    ; #7 = position of sequence
        const #19, [0.5]
        mul #14, #14, #19
        add #13, #13, #14
        const #50, [2]
        add #13, #13, #50
        const #28, [0]
        shape #11, #7, #28, #13, #28, #9 ; draw letter        
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Contigs"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #12

    gc: |
        ;const #98, {"[%GC]/[<strong>{key}</strong> GC]"}
        ;const #99, {"gc"}
        ;ztmplspec #99, #98
        ;const #98, {"gc"}
        ;const #99, {"gcid"}
        ;ztmpl #99, #98
        ;const #97, {"key"}
        ;const #98, {"percentage"}
        ;const #99, {"gcid"}
        ;zmenu #99, #97, #98
        const #57, [2]  ; scale/clip factor
        const #58, [18] ; wanted graph height (px)
        ; Get track top and height in #60, #61, graph height #59
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #63, [1]
        get #61, #62, #63
        ; move #60 to mid-way
        move #62, #61
        const #63, [0.5]
        mul #62, #62, #63
        add #60, #60, #62
        ; move #60 down half height for baseline
        move #62, #58
        const #63, [0.5]
        mul #62, #62, #63
        add #60, #60, #62
        ; track zmenu
        const #98, {"[%GC]"}
        const #99, {"gc"}
        ztmplspec #99, #98
        const #98, {"gc"}
        const #99, {"internal:track:gc"}
        ztmpl #99, #98
        const #10, [0,2,1,2,0,0,0,0,0,0,3]
        const #11, [0]
        const #15, {"internal:track:gc"}
        shape #10, #11, #11, #60, #58, #15
        ; convert height to multiplier for y-coord.
        ; we want -value*height/100. ie our multiplier is height/-100
        ; ... remove 100 from %ageness 0..1
        move #62, #4
        mul #2, #2, #62
        ; ... scale data as requested
        mul #2, #2, #57
        move #62, #57
        const #63, [-0.5]
        mul #62, #62, #63
        add #2, #2, #62
        const #63, [0.5]
        add #2, #2, #63
        ; ... clip
        const #62, [1]
        min #2, #2, #62
        const #62, [0]
        max #2, #2, #62
        ; ... scale to our height
        mul #2, #2, #58
        ; ... flip
        const #62, [-1]
        mul #2, #2, #62
        ; add base coord
        add #2, #2, #60
        ; generate x-coordinates ...
        ; ... length bp
        const #40, [0]
        get #30, #1, #40
        const #40, [1]
        get #4, #1, #40
        const #40, [-1.0]
        mul #63, #30, #40
        add #63, #63, #4
        const #4, [0]
        length #5, #2
        runs #1, #4, #5
        div #4, #63, #5
        mul #1, #1, #4
        add #1, #1, #30
        ; draw wiggle
        const #10, [4,1]
        const #15, [255,153,0]
        shape #10, #1, #10, #2, #10, #15
        ; draw centre-line
        move #63, #58      ; #63 = graph-height
        const #64, [-0.5]  ; #64 = -0.5
        mul #64, #64, #57  ; #64 = -0.5*scale
        mul #3, #3, #64    ; #3 = 0.5*(-0.5)*scale
        mul #63, #63, #3   ; #63 = graph-height * (-0.25) * scale
        add #63, #63, #60  ; #63 = top - 0.25*scale * graph-height
        const #10, [0,1,1,2,0,0,0,0,0,0,3]
        const #11, [0]
        const #13, [1]
        const #15, [192,192,192]
        shape #10, #11, #11, #63, #13, #15
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"%GC"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #12

    gene-shimmer: |
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [-3]
        add #44, #60, #62
        const #15, [183,192,200,   111,129,144,   0,153,255]
        const #16, [3]
        const #97, [0]
        get #97, #4, #97
        pick #15, #97, #15, #16
        const #5, [6]
        const #10, [1,1]
        shape #10, #1, #2, #44, #5, #15
        ; draw chevrons
        const #97, {"chevron-left"}
        const #98, [0]
        asset #90, #97, #98
        const #98, [1]
        asset #91, #97, #98
        image #90, #90, #91, #97
        const #97, {"chevron-right"}
        const #98, [0]
        asset #92, #97, #98
        const #98, [1]
        asset #91, #97, #98
        image #98, #92, #91, #97
        const #6, [0]
        const #7, [14]
        const #8, [0]
        const #100, [1]
        const #101, [0]
        const #102, [60]
        const #107, [1]
        get #107, #4, #107
        const #100, [1]
        eq #107, #107, #100
        const #100, [1]
        elide #101, #107, #100
        runs #100, #101, #102
        const #101, [50]
        mul #100, #100, #101
        const #41, [3,0, 1,1,0,1, 0,0,1,11, 3]
        shape #41, #100, #8, #60, #7, #98
        const #107, [1]
        get #107, #4, #107
        const #100, [0]
        eq #107, #107, #100
        const #101, [1]
        elide #101, #107, #101
        runs #100, #101, #102
        const #101, [50]
        mul #100, #100, #101
        shape #41, #100, #8, #60, #7, #90
        ; track zmenu
        const #98, {"[Genes]"}
        const #99, {"genes"}
        ztmplspec #99, #98
        const #98, {"genes"}
        const #99, {"internal:track:gene"}
        ztmpl #99, #98
        const #100, [0,2, 1,2,0,0, 0,0,2,2, 3]
        const #101, [0]
        const #105, {"internal:track:gene"}
        shape #100, #101, #101, #4, #5, #105        
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Contigs"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #12

    gene: |
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [-2]
        add #60, #60, #62
        ; draw genes
        const #10, [1,1]
        const #15, [183,192,200,   111,129,144,   0,153,255]
        const #16, [3]
        const #97, [0]
        get #97, #4, #97
        pick #15, #97, #15, #16
        const #25, [4]
        shape #10, #1, #2, #60, #25, #15
        ; draw gene zmenus
        const #98, {"[{symbol}] [{id}] / [{strand}] [{biotype}]"}
        const #99, {"gene"}
        ztmplspec #99, #98
        const #98, {"gene"}
        ztmpl #5, #98
        const #98, {"symbol"}
        zmenu #5, #98, #3
        const #98, {"id"}
        zmenu #5, #98, #5
        const #98, {"strand"}
        zmenu #5, #98, #6
        const #98, {"biotype"}
        zmenu #5, #98, #7
        const #10, [1,2]
        shape #10, #1, #2, #60, #25, #5
        ; draw feature line
        const #45, [3,0, 0,1,0,1, 1,1,0,2, 0]
        const #12, [1.0]
        const #13, [17]
        const #14, [0]
        const #11, [173,37,0]
        const #201, {"dotted-line"}
        const #202, [0]
        asset #203, #201, #202
        const #202, [1]
        asset #204, #201, #202
        image #200, #203, #204, #201
        move #100, #1
        const #101, [2]
        eq #102, #4, #101
        const #101, [1]
        elide #100, #102, #101
        const #12, [2]
        const #14, [0]
        shape #45, #100, #12, #13, #14, #200
        move #100, #1
        add #100, #100, #2
        const #101, [2]
        eq #102, #4, #101
        const #101, [1]
        elide #100, #102, #101
        shape #45, #100, #12, #13, #14, #200
        ; draw chevrons
        const #97, {"chevron-left"}
        const #98, [0]
        asset #90, #97, #98
        const #98, [1]
        asset #91, #97, #98
        image #90, #90, #91, #97
        const #97, {"chevron-right"}
        const #98, [0]
        asset #92, #97, #98
        const #98, [1]
        asset #91, #97, #98
        image #98, #92, #91, #97
        const #6, [0]
        const #7, [14]
        const #8, [0]
        const #100, [1]
        const #101, [0]
        const #102, [60]
        const #107, [1]
        get #107, #4, #107
        const #100, [1]
        eq #107, #107, #100
        const #100, [1]
        elide #101, #107, #100
        runs #100, #101, #102
        const #101, [50]
        mul #100, #100, #101
        const #41, [3,0, 1,1,0,1, 0,0,1,11, 3]
        shape #41, #100, #8, #60, #7, #98
        const #107, [1]
        get #107, #4, #107
        const #100, [0]
        eq #107, #107, #100
        const #101, [1]
        elide #101, #107, #101
        runs #100, #101, #102
        const #101, [50]
        mul #100, #100, #101
        shape #41, #100, #8, #60, #7, #90
        ; draw gene names
        const #99, {"names"}
        setpart #99
        const #20, {"Lato"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #40, #20, #21, #3
        const #41, [3,0, 0,1,0,1, 0,0,1,0, 0]
        const #6, [0]
        const #7, [14]
        const #8, [0]
        shape #41, #1, #8, #60, #7, #40
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Genes"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #25, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #25, #6, #8, #60, #7, #12

    transcript: |
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [0]
        add #60, #60, #62
        ; draw feature line
        const #45, [3,0, 0,1,0,1, 1,1,0,2, 0]
        const #12, [1.0]
        const #13, [17]
        const #14, [0]
        const #11, [173,37,0]
        const #201, {"dotted-line"}
        const #202, [0]
        asset #203, #201, #202
        const #202, [1]
        asset #204, #201, #202
        image #200, #203, #204, #201
        move #100, #1
        const #101, [2]
        eq #102, #8, #101
        const #101, [1]
        elide #100, #102, #101
        const #12, [2]
        const #14, [0]
        shape #45, #100, #12, #13, #14, #200
        move #100, #1
        add #100, #100, #9
        const #101, [2]
        eq #102, #8, #101
        const #101, [1]
        elide #100, #102, #101
        shape #45, #100, #12, #13, #14, #200
        ; draw chevrons
        const #97, {"chevron-left"}
        const #98, [0]
        asset #90, #97, #98
        const #98, [1]
        asset #91, #97, #98
        image #90, #90, #91, #97
        const #97, {"chevron-right"}
        const #98, [0]
        asset #92, #97, #98
        const #98, [1]
        asset #91, #97, #98
        image #98, #92, #91, #97
        const #116, [0]
        const #117, [14]
        const #118, [0]
        const #100, [1]
        const #101, [0]
        const #102, [60]
        const #107, [1]
        get #107, #8, #107
        const #100, [1]
        eq #107, #107, #100
        const #100, [1]
        elide #101, #107, #100
        runs #100, #101, #102
        const #101, [50]
        mul #100, #100, #101
        const #41, [3,0, 1,1,0,1, 0,0,1,11, 3]
        shape #41, #100, #118, #60, #117, #98
        const #107, [1]
        get #107, #8, #107
        const #100, [0]
        eq #107, #107, #100
        const #101, [1]
        elide #101, #107, #101
        runs #100, #101, #102
        const #101, [50]
        mul #100, #100, #101
        shape #41, #100, #118, #60, #117, #90
        ; y-position
        runsof #30, #2, #1
        merge #31, #3, #4, #5, #6
        accn #12, #31, #2
        add #13, #30, #12
        const #14, [-1]
        mul #14, #31, #14
        add #14, #13, #14
        ; draw gene zmenus
        const #98, {"[{symbol}]"}
        const #99, {"gene"}
        ztmplspec #99, #98
        const #98, {"gene"}
        ztmpl #7, #98
        const #98, {"symbol"}
        zmenu #7, #98, #7
        const #10, [1,2]
        const #97, [7]
        shape #10, #1, #9, #60, #97, #7
        ; extract + draw
        ; (colour)
        const #15, [183,192,200,   111,129,144,   0,153,255]
        const #16, [3]
        const #100, [0]
        get #100, #8, #100
        pick #15, #100, #15, #16
        ; *** utr ***
        const #30, [2,1]
        move #12, #60
        const #17, [-4]
        add #12, #12, #17
        const #13, [7]
        const #16, [0]
        eq #16, #3, #16
        move #29, #14
        const #17, [1]
        elide #29, #16, #17
        move #10, #31
        elide #10, #16, #17
        shape #30, #29, #10, #12, #13, #15
        ; *** exon ***
        const #30, [1,1]
        const #16, [1]
        eq #16, #3, #16
        move #29, #14
        const #17, [1]
        elide #29, #16, #17
        move #10, #31
        elide #10, #16, #17
        shape #30, #29, #10, #12, #13, #15
        ; *** intron ***
        const #30, [1,1]
        const #16, [2]
        move #12, #60
        const #17, [-1]
        add #12, #12, #17
        const #13, [1]
        eq #16, #3, #16
        move #29, #14
        const #17, [1]
        elide #29, #16, #17
        move #10, #31
        elide #10, #16, #17
        shape #30, #29, #10, #12, #13, #15
        ; transcript label
        const #99, {"names"}
        setpart #99
        const #20, {"Lato"}
        const #21, [10,0,96,96,96,255,255,255]
        text2 #40, #20, #21, #7
        const #41, [3,0, 0,1,0,1, 0,0,1,0, 0]
        const #47, [14]
        const #48, [0]
        shape #41, #1, #48, #60, #47, #40        
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Transcripts"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #29, [2]
        const #10, [30]
        shape #5, #6, #10, #60, #29, #12

    gene-empty-box: |
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [-3]
        add #60, #60, #62
        ; y-position
        ; see previous scale for details in comments.
        ; register usage essentially same.
        ; draw feature line
        const #45, [3,0, 0,1,0,1, 1,1,0,2, 0]
        const #12, [1.0]
        const #13, [17]
        const #14, [0]
        const #11, [173,37,0]
        const #201, {"dotted-line"}
        const #202, [0]
        asset #203, #201, #202
        const #202, [1]
        asset #204, #201, #202
        image #200, #203, #204, #201
        move #100, #1
        const #101, [2]
        eq #102, #8, #101
        const #101, [1]
        elide #100, #102, #101
        const #12, [2]
        const #14, [0]
        shape #45, #100, #12, #13, #14, #200
        move #100, #1
        add #100, #100, #9
        const #101, [2]
        eq #102, #8, #101
        const #101, [1]
        elide #100, #102, #101
        shape #45, #100, #12, #13, #14, #200
        ; We also use #9, as tmp and reuse #1,#2 as tmp.
        runsof #10, #2, #1
        merge #11, #3, #4, #5, #6
        accn #12, #11, #2
        add #13, #10, #12
        const #14, [-1]
        mul #14, #11, #14
        add #14, #13, #14
        ; draw gene zmenus
        const #98, {"[{symbol}]"}
        const #99, {"gene"}
        ztmplspec #99, #98
        const #98, {"gene"}
        ztmpl #7, #98
        const #98, {"symbol"}
        zmenu #7, #98, #7
        const #10, [1,2]
        const #97, [7]
        shape #10, #1, #9, #60, #97, #7
        ; *** utrs and introns ***
        const #15, [75,168,252]
        const #15, [212,217,222,   157,169,180, 112,198,255]
        const #16, [3]
        const #100, [0]
        get #100, #8, #100        
        pick #15, #100, #15, #16
        const #10, [2,1]
        move #12, #60
        const #13, [6]
        const #16, [0]
        eq #29, #3, #16
        const #16, [2]
        eq #16, #3, #16
        or #16, #16, #29
        move #7, #14
        const #17, [1]
        elide #7, #16, #17
        move #88, #11
        elide #88, #16, #17
        runs #29, #7, #88
        const #1, [-0.45]
        add #29, #29, #1
        const #2, [0.9]
        shape #10, #29, #2, #12, #13, #15
        ; *** exons ***
        const #15, [183,192,200,   111,129,144,  0,153,255]
        const #16, [3]
        const #100, [0]
        get #100, #8, #100
        pick #15, #100, #15, #16
        const #10, [1,1]
        const #16, [1]
        eq #16, #3, #16
        move #7, #14
        const #17, [1]
        elide #7, #16, #17
        move #8, #11
        elide #8, #16, #17
        runs #29, #7, #8
        const #1, [-0.45]
        add #29, #29, #1
        const #2, [0.9]
        shape #10, #29, #2, #12, #13, #15
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Transcripts and Sequence"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #12, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #12

    gene-letterbox: |
        const #17, [
             12, 24, 24, 24, 24, 24, 24, 24, 24, 24
        ]
        scale #18
        const #19, [-16]
        add #18, #18, #19
        get #53, #17, #18
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #22, [-0.5]
        mul #62, #53, #22
        add #22, #60, #62
        ; draw feature line
        const #45, [3,0, 0,1,0,1, 1,1,0,2, 0]
        const #112, [1.0]
        const #113, [17]
        const #114, [0]
        const #201, {"dotted-line"}
        const #202, [0]
        asset #203, #201, #202
        const #202, [1]
        asset #204, #201, #202
        image #200, #203, #204, #201
        move #100, #1
        const #101, [2]
        eq #102, #8, #101
        const #101, [1]
        elide #100, #102, #101
        const #12, [2]
        const #14, [0]
        shape #45, #100, #112, #113, #114, #200
        move #100, #1
        add #100, #100, #9
        const #101, [2]
        eq #102, #8, #101
        const #101, [1]
        elide #100, #102, #101
        shape #45, #100, #112, #113, #114, #200
        ; *** scale (for size) ***
        ; decode necklaces
        runsof #30, #2, #1
        merge #31, #3, #4, #5, #6
        accn #14, #31, #2
        add #20, #30, #14
        const #14, [-1]
        mul #14, #31, #14
        add #14, #20, #14
        ; colours: a. boxes
        const #15, [183,192,200,   111,129,144,   0,153,255]
        const #16, [3]
        const #100, [0]
        get #100, #8, #100        
        pick #15, #100, #15, #16
        ; b. exon text
        const #41, [12,1,255,255,255,183,192,200,
                    12,1,255,255,255,111,129,144,
                    12,1,255,255,255,0,153,255]
        const #16, [8]
        pick #41, #8, #41, #16
        ; c. intron/utr text
        const #42, [12,1,183,192,200,255,255,255,
                    12,1,111,129,144,255,255,255,
                    12,1,0,153,255,255,255,255]
        const #16, [8]
        const #100, [0]
        get #100, #8, #100        
        pick #42, #100, #42, #16        
        ; draw gene zmenus
        const #98, {"[{symbol}]"}
        const #99, {"gene"}
        ztmplspec #99, #98
        const #98, {"gene"}
        ztmpl #7, #98
        const #98, {"symbol"}
        zmenu #7, #98, #7
        const #200, [1,2]
        const #97, [7]
        shape #200, #1, #9, #60, #97, #7
        ; *** utrs and introns ***
        const #30, [2,1]
        const #16, [0]
        eq #20, #3, #16
        const #16, [2]
        eq #16, #3, #16
        or #16, #16, #20
        move #18, #14
        const #17, [1]
        elide #18, #16, #17
        move #19, #31
        elide #19, #16, #17
        runs #20, #18, #19
        const #1, [-0.45]
        add #20, #20, #1
        move #36, #20
        const #2, [0.9]
        shape #30, #20, #2, #22, #53, #15
        ; *** exons ***
        const #30, [1,1]
        const #16, [1]
        eq #16, #3, #16
        move #18, #14
        const #17, [1]
        elide #18, #16, #17
        move #19, #31
        elide #19, #16, #17
        runs #20, #18, #19
        const #1, [-0.45]
        add #20, #20, #1
        move #35, #20
        const #2, [0.9]
        shape #30, #20, #2, #22, #53, #15
        ; *** exon text ***
        const #27, {"A","C","G","T","N"}
        const #40, {"Lato"}
        text2 #29, #40, #41, #27
        lengths #12,#10
        burst #10,#10
        index #57, #10, #27
        const #30, [1]
        pick #29, #57, #29, #30
        const #31, [3,0,0,1,0,1,1,0,1,0,0]
        runs #27, #11, #12
        member #34, #27, #35
        elide #27, #34, #30
        elide #29, #34, #30
        move #33, #22
        const #50, [0.5]
        mul #63, #53, #50
        const #50, [2]
        add #63, #63, #50
        add #33, #33, #63
        const #64, [0]
        shape #31, #27, #64, #33, #64, #29
        ; *** intron text ***
        const #27, {"A","C","G","T","N"}
        const #40, {"Lato"}
        text2 #29, #40, #42, #27
        index #57, #10, #27
        const #30, [1]
        pick #29, #57, #29, #30
        const #31, [3,0,0,1,0,1,1,0,1,0,0]
        runs #27, #11, #12
        member #34, #27, #36
        elide #27, #34, #30
        elide #29, #34, #30
        move #33, #22
        const #50, [0.5]
        mul #63, #53, #50
        const #50, [2]
        add #63, #63, #50
        add #33, #33, #63
        const #64, [0]
        shape #31, #27, #64, #33, #64, #29
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Transcripts and Sequence"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #22, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #22


    variant: |
        plot #62, #0
        const #63, [1]
        get #61, #62, #63
        const #60, [0.5]
        mul #61, #61, #60
        const #63, [0]
        get #60, #62, #63
        add #60, #60, #61
        const #62, [-3]
        add #60, #60, #62
        const #10, [1,1]
        const #15, [
            0,0,0, 57,135,148,  160,214,207,  143,251, 66,  249,200, 74,
            223, 30, 29]
        const #17, [3]
        pick #15, #3, #15, #17
        const #5, [6]
        shape #10, #1, #2, #60, #5, #15
        ; track zmenu
        const #98, {"[Variants]"}
        const #99, {"variant"}
        ztmplspec #99, #98
        const #98, {"variant"}
        const #99, {"internal:track:variant"}
        ztmpl #99, #98
        const #10, [0,2,1,2,0,0,0,0,2,2,3]
        const #11, [0]
        const #15, {"internal:track:variant"}
        shape #10, #11, #11, #60, #5, #15
        ; draw track label
        const #99, {"label"}
        setpart #99
        const #20, {"Lato"}
        const #44, {"Variants"}
        const #21, [10,0,111,129,144,255,255,255]
        text2 #13, #20, #21, #44
        plot #62, #0
        const #63, [0]
        get #60, #62, #63
        const #5, [3,0,1,1,0,1,0,0,1,0,0]
        const #6, [0]
        const #7, [2]
        const #8, [30]
        shape #5, #6, #8, #60, #7, #13

        
endpoints:
    contig-normal:
        endpoint: contignormal
        bytecode: contig

    contig-emptybox:
        endpoint: contignormal
        bytecode: contig-empty-box

    contig-letterbox:
        endpoint: contignormal-seq
        bytecode: contig-letterbox

    contig-shimmer:
        endpoint: contigshimmer
        bytecode: contig

    trans-pc-fwd:
        endpoint: transcript-pc-fwd
        bytecode: transcript

    trans-pc-rev:
        endpoint: transcript-pc-rev
        bytecode: transcript

    trans-other-fwd:
        endpoint: transcript-other-fwd
        bytecode: transcript

    trans-other-rev:
        endpoint: transcript-other-rev
        bytecode: transcript

    trans-feat:
        endpoint: transcript-feat
        bytecode: transcript

    gene-pc-fwd:
        endpoint: gene-pc-fwd
        bytecode: gene-shimmer

    gene-pc-rev:
        endpoint: gene-pc-rev
        bytecode: gene-shimmer

    gene-other-fwd:
        endpoint: gene-other-fwd
        bytecode: gene-shimmer

    gene-other-rev:
        endpoint: gene-other-rev
        bytecode: gene-shimmer

    gene-feat:
        endpoint: gene-feat
        bytecode: gene-shimmer

    gene-pc-fwd-names:
        endpoint: gene-pc-fwd-names
        bytecode: gene

    gene-pc-rev-names:
        endpoint: gene-pc-rev-names
        bytecode: gene

    gene-other-fwd-names:
        endpoint: gene-other-fwd-names
        bytecode: gene

    gene-other-rev-names:
        endpoint: gene-other-rev-names
        bytecode: gene

    gene-feat-names:
        endpoint: gene-feat-names
        bytecode: gene

    geneeb-pc-fwd:
        endpoint: transcript-pc-fwd
        bytecode: gene-empty-box

    geneeb-pc-rev:
        endpoint: transcript-pc-rev
        bytecode: gene-empty-box

    geneeb-other-fwd:
        endpoint: transcript-other-fwd
        bytecode: gene-empty-box

    geneeb-other-rev:
        endpoint: transcript-other-rev
        bytecode: gene-empty-box

    geneeb-feat:
        endpoint: transcript-feat
        bytecode: gene-empty-box

    genesb-pc-fwd:
        endpoint: transcript-pc-fwd-seq
        bytecode: gene-letterbox

    genesb-pc-rev:
        endpoint: transcript-pc-rev-seq
        bytecode: gene-letterbox

    genesb-other-fwd:
        endpoint: transcript-other-fwd-seq
        bytecode: gene-letterbox

    genesb-other-rev:
        endpoint: transcript-other-rev-seq
        bytecode: gene-letterbox

    genesb-feat:
        endpoint: transcript-feat-seq
        bytecode: gene-letterbox

    variant-z:
        endpoint: variant-z
        bytecode: variant

    variant-y:
        endpoint: variant-y
        bytecode: variant

    variant-x:
        endpoint: variant-x
        bytecode: variant

    variant-w:
        endpoint: variant-w
        bytecode: variant

    variant-v:
        endpoint: variant-v
        bytecode: variant

    variant-u:
        endpoint: variant-u
        bytecode: variant

    variant-t:
        endpoint: variant-t
        bytecode: variant

    variant-s:
        endpoint: variant-s
        bytecode: variant

    gc:
        endpoint: gc
        bytecode: gc

    framework:
        bytecode: framework

tracks:
    contig:
        wire: cc
        letter: G
        position: 3
        endpoints:
            AI:
                endpoint: contig-shimmer
            JO:
                endpoint: contig-normal
            PP:
                endpoint: contig-emptybox
            QS:
                endpoint: contig-letterbox
        parts:
            - label


    zzz-framework:
        wire: zz
        position: -1
        endpoints:
            AS:
                endpoint: framework
        parts:
            - lhs

    gene-feat:
        wire: ff
        letter: G
        position: 0
        endpoints:
            AG:
                endpoint: gene-feat
            HH:
                endpoint: gene-feat-names
            IO:
                endpoint: trans-feat
            PP:
                endpoint: geneeb-feat
            QS:
                endpoint: genesb-feat
        parts:
            - label
            - names

    gene-pc-fwd:
        wire: pf
        letter: G
        position: 1
        endpoints:
            AG:
                endpoint: gene-pc-fwd
            HH:
                endpoint: gene-pc-fwd-names
            IO:
                endpoint: trans-pc-fwd
            PP:
                endpoint: geneeb-pc-fwd
            QS:
                endpoint: genesb-pc-fwd
        parts:
            - label
            - names

    gene-pc-rev:
        wire: pr
        letter: G
        position: 4
        endpoints:
            AG:
                endpoint: gene-pc-rev
            HH:
                endpoint: gene-pc-rev-names
            IO:
                endpoint: trans-pc-rev
            PP:
                endpoint: geneeb-pc-rev
            QS:
                endpoint: genesb-pc-rev
        parts:
            - label
            - names

    gene-other-fwd:
        wire: of
        letter: G
        position: 2
        endpoints:
            AG:
                endpoint: gene-other-fwd
            HH:
                endpoint: gene-other-fwd-names
            IO:
                endpoint: trans-other-fwd
            PP:
                endpoint: geneeb-other-fwd
            QS:
                endpoint: genesb-other-fwd
        parts:
            - label
            - names

    gene-other-rev:
        wire: or
        letter: G
        position: 5
        endpoints:
            AG:
                endpoint: gene-other-rev
            HH:
                endpoint: gene-other-rev-names
            IO:
                endpoint: trans-other-rev
            PP:
                endpoint: geneeb-other-rev
            QS:
                endpoint: genesb-other-rev
        parts:
            - label
            - names

    variant:
        wire: vv
        letter: V
        position: 6
        endpoints:
            PS:
                endpoint: variant-z
            "NO":
                endpoint: variant-y
            MM:
                endpoint: variant-x
            LL:
                endpoint: variant-w
            KK:
                endpoint: variant-v
            IJ:
                endpoint: variant-u
            FH:
                endpoint: variant-t
            EE:
                endpoint: variant-s
            BD:
                endpoint: variant-r
        parts:
            - label


    gc:
        wire: gc
        letter: G
        position: 7
        endpoints:
            AS:
                endpoint: gc
        parts:
            - label

assets:
    chevron-left:
        filter: png
        filename: chevron-left.png

    chevron-right:
        filter: png
        filename: chevron-right.png
 
    dotted-line:
        filter: png
        filename: dotted-line.png
